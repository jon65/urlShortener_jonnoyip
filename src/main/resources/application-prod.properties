# Production - Google Cloud SQL Configuration
# Connection method: Use Unix socket when running on GCP, TCP when using Cloud SQL Proxy
# Set GCP_CLOUD_SQL_CONNECTION_NAME in format: PROJECT_ID:REGION:INSTANCE_NAME
# Example: my-project:us-central1:my-instance

# Option 1: Unix Socket (recommended when running on GCP App Engine, Cloud Run, or GCE)
# Uncomment and configure these if using Unix socket connection:
#spring.datasource.url=jdbc:postgresql:///${DB_NAME}?cloudSqlInstance=${GCP_CLOUD_SQL_CONNECTION_NAME}&socketFactory=com.google.cloud.sql.postgres.SocketFactory
#spring.datasource.username=${GCP_DB_USERNAME}
#spring.datasource.password=${GCP_DB_PASSWORD}

# Option 2: TCP Connection (use when running outside GCP or with Cloud SQL Proxy)
# For Cloud SQL Proxy: Connect to localhost:5432 (or your proxy port)
# For direct TCP: Use the public IP of your Cloud SQL instance
spring.datasource.url=${GCP_DB_URL:jdbc:postgresql://localhost:5432/${GCP_DB_NAME:urlshortener}}
spring.datasource.username=${GCP_DB_USERNAME}
spring.datasource.password=${GCP_DB_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Cloud SQL Socket Factory Configuration (for Unix socket connections)
# Uncomment if using Unix socket:
#spring.datasource.hikari.data-source-properties.cloudSqlInstance=${GCP_CLOUD_SQL_CONNECTION_NAME}
#spring.datasource.hikari.data-source-properties.socketFactory=com.google.cloud.sql.postgres.SocketFactory

# Connection Pool - Production optimized settings
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# JPA/Hibernate - Production settings
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=false

# Flyway - Production settings
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=true

# Logging - Production settings
logging.level.root=WARN
logging.level.com.jonnoyip.urlshortener=INFO
logging.level.org.springframework.web=WARN
logging.level.org.hibernate=WARN

# Actuator - Production settings
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized

